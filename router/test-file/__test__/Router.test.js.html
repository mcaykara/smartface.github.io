<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">__test__/Router.test.js | Smartface NativeRouter</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Smartface NativeRouter"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="Smartface NativeRouter"><meta property="twitter:description" content="Smartface NativeRouter"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/smartface/router"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#common">common</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createMemoryHistory">createMemoryHistory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-matchPath">matchPath</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-matchRoutes">matchRoutes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-pathToRegexp">pathToRegexp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#native">native</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/native/BottomTabBarRouter.js~BottomTabBarRouter.html">BottomTabBarRouter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/native/NativeStackRouter.js~NativeStackRouter.html">NativeStackRouter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-NavigationControllerTransformEvent">NavigationControllerTransformEvent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="http://docs.smartface.io/#!/api/UI.BottomTabBarController">BottomTabBarController</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="http://docs.smartface.io/#!/api/UI.BottomTabBarItem">BottomTabBarItem</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="http://docs.smartface.io/#!/api/UI.NavigationController">NavigationController</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="http://docs.smartface.io/#!/api/UI.Page">Page</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#router">router</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/router/Route.js~Route.html">Route</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/router/Route.js~RoutePath.html">RoutePath</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/router/Router.js~Router.html">Router</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createRouteData">createRouteData</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-RouteBuildHandler">RouteBuildHandler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-RouteLocation">RouteLocation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-RouteMatch">RouteMatch</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-RouteParams">RouteParams</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-RouteState">RouteState</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-HistoryListener">HistoryListener</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-RouterBlockHandler">RouterBlockHandler</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">__test__/Router.test.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">const Router = require(&quot;../src/router/Router&quot;);
const Route = require(&quot;../src/router/Route&quot;);
const matchRoutes = require(&quot;../src/common/matchRoutes&quot;);

describe(&quot;Router&quot;, () =&gt; {
  afterEach(() =&gt; {
    Router.unloadHistory();
  });
  it(&quot;has routes&quot;, () =&gt; {
    const router = new Router({
      isRoot: true,
      routes: [
        new Route(&quot;/path/to/:name&quot;),
        new Route(&quot;/path/to/:id&quot;),
        new Route(&quot;/path/to&quot;)
      ]
    });
    let routes = [];
    router.map(route =&gt; {
      routes.push(route);
    });
    expect(routes.length).toBe(3);
  });
  it(&quot;finds target by url&quot;, () =&gt; {
    const router = new Router({
      path: &quot;/&quot;,
      exact: false,
      isRoot: true,
      routes: [
        new Route({
          path: &quot;/path/to/:name&quot;,
          build: (props, match) =&gt; ({
            type: &quot;target1&quot;
          })
        }),
        new Route({
          path: &quot;/path/to/:id&quot;,
          build: (props, match) =&gt; ({
            type: &quot;target2&quot;
          })
        }),
        new Route({ path: &quot;*&quot;, build: (props, match) =&gt; ({ type: &quot;target3&quot; }) })
      ]
    });
    // let matches = matchRoutes([router], &quot;/path/to/1&quot;).map(
    //   ({ match, route }) =&gt; ({ match, route: route.toObject(), view: route.build() })
    // );
    var matches = router
      .push(&quot;/path/to/1&quot;)
      ._matches.map(({ match, route }) =&gt; ({
        match,
        route: route.toObject(),
        view: route.build()
      }));

    expect(matches).toEqual([
      {
        match: { isExact: false, params: {}, path: &quot;/&quot;, url: &quot;/&quot; },
        route: {
          path: &quot;/&quot;,
          routes: [
            { path: &quot;/path/to/:name&quot;, routes: [] },
            { path: &quot;/path/to/:id&quot;, routes: [] },
            { path: &quot;*&quot;, routes: [] }
          ]
        },
        view: null
      },
      {
        match: {
          isExact: true,
          params: { name: &quot;1&quot; },
          path: &quot;/path/to/:name&quot;,
          url: &quot;/path/to/1&quot;
        },
        route: { path: &quot;/path/to/:name&quot;, routes: [] },
        view: { type: &quot;target1&quot; }
      }
    ]);
  });
  it(&quot;return only root path if any route doesn&apos;t be matched&quot;, () =&gt; {
    const router = new Router({
      path: &quot;/&quot;,
      isRoot: true,
      routes: [
        new Route({
          path: &quot;/path/to/:name&quot;,
          build: () =&gt; {
            type: &quot;target1&quot;;
          }
        }),
        new Route({
          path: &quot;/path/to/:id&quot;,
          build: () =&gt; {
            type: &quot;target2&quot;;
          }
        }),
        new Route({ path: &quot;*&quot;, build: { type: &quot;target3&quot; } })
      ]
    });

    let matches = router.push(&quot;/path/to&quot;)._matches;
    expect(matches.map(({ match }) =&gt; match)).toEqual([
      {
        isExact: false,
        params: {},
        path: &quot;/&quot;,
        url: &quot;/&quot;
      }
    ]);
  });

  it(&quot;sends data and params to specified route&quot;, () =&gt; {
    let data;
    const router = new Router({
      path: &quot;/&quot;,
      isRoot: true,
      routes: [
        new Route({
          path: &quot;/path/to/:name&quot;,
          build: (match, state) =&gt; {
            data = {
              params: match.params,
              state
            };
            return { type: &quot;target1&quot; };
          }
        }),
        new Route({
          path: &quot;/path/too/:name&quot;,
          build: () =&gt; {
            type: &quot;target2&quot;;
          }
        }),
        new Route({ path: &quot;*&quot;, build: { type: &quot;target3&quot; } })
      ]
    });
    let matches = router.push(&quot;/path/to/1&quot;, { name: &quot;name&quot; });
    expect(data).toEqual({
      params: { name: &quot;1&quot; },
      state: { data: { name: &quot;name&quot; } }
    });
  });
  it(&quot;gets history back&quot;, () =&gt; {
    let data;
    let callCount = 0;
    var component = {};
    const router = new Router({
      path: &quot;/&quot;,
      isRoot: true,
      routes: [
        new Router({
          path: &quot;/path&quot;,
          routes: [
            new Route({
              path: &quot;/path/to/:name&quot;,
              build: (match, state, router) =&gt; {
                data = {
                  params: match.params,
                  state
                };

                callCount++;
                return { type: &quot;target1&quot; };
              }
            }),
            new Route({
              path: &quot;/path/too/:name&quot;,
              build: (params, state, router) =&gt; {
                component.router = router;
                return component;
              }
            }),
            new Route({ path: &quot;*&quot;, build: { type: &quot;target3&quot; } })
          ]
        })
      ]
    });

    router.push(&quot;/path/to/1&quot;, { name: &quot;name&quot; });
    router.push(&quot;/path/too/dev&quot;, { name: &quot;name&quot; });
    component.router.goBack();

    expect(data).toEqual({
      params: { name: &quot;1&quot; },
      state: { data: { name: &quot;name&quot; } }
    });

    expect(component.router === router).toBe(false);
    expect(callCount).toBe(2);
  });

  it(&quot;calls back to parent if its history is empty&quot;, () =&gt; {
    let data;
    let callCount = 0;
    var component = {};

    const router = new Router({
      path: &quot;/&quot;,
      isRoot: true,
      routes: [
        new Route({
          path: &quot;/path2/to/:name&quot;,
          build: (match, state, router) =&gt; {
            data = {
              params: match.params,
              state
            };
            // component.router = router;
            callCount++;
            return { type: &quot;target1&quot; };
          }
        }),
        new Router({
          path: &quot;/path&quot;,
          routes: [
            new Route({
              path: &quot;/path/to/:name&quot;,
              build: (params, state, router) =&gt; {
                component.router = router;
                return component;
              }
            }),
            new Route({ path: &quot;*&quot;, build: { type: &quot;target3&quot; } })
          ]
        })
      ]
    });

    router.push(&quot;/path2/to/1&quot;, { name: &quot;name&quot; });
    router.push(&quot;/path/to/dev&quot;, { name: &quot;name&quot; });
    component.router.goBack();

    expect(data).toEqual({
      params: { name: &quot;1&quot; },
      state: { data: { name: &quot;name&quot; } }
    });
    expect(callCount).toBe(2);
  });
  it(&quot;can call a relative path&quot;, () =&gt; {
    let data;
    let callCount = 0;
    var component1 = {};
    var component2 = {};

    const router = new Router({
      path: &quot;/&quot;,
      isRoot: true,
      routes: [
        new Route({
          path: &quot;/path2/to/:name&quot;,
          build: (match, state, router) =&gt; {
            data = {
              params: match.params,
              state
            };
            // component.router = router;
            callCount++;
            return { type: &quot;target1&quot; };
          }
        }),
        new Router({
          path: &quot;/path&quot;,
          routes: [
            new Route({
              path: &quot;/path/to/:name([a-zA-Z]*)&quot;,
              build: (match, state, router) =&gt; {
                component1.router = router;
                component1.params = match.params;
                return component1;
              }
            }),
            new Route({
              path: &quot;/path/to/:id&quot;,
              build: (match, state, router, view) =&gt; {
                component2.router = router;
                component2.params = match.params;
                return component2;
              }
            })
          ]
        })
      ]
    });

    router.push(&quot;/path/to/cenk&quot;, { name: &quot;name&quot; });
    component1.router.push(&quot;to/1123&quot;, { name: &quot;name&quot; });

    expect(component1.router === router).toBe(false);
    expect(component1.params.name).toBe(&quot;cenk&quot;);
    expect(component2.params.id).toBe(&quot;1123&quot;);
  });
  it(&quot;can call a relative path&quot;, () =&gt; {
    let data;
    let callCount = 0;
    var component1 = {};
    var component2 = {};
    const router = new Router({
      path: &quot;/&quot;,
      isRoot: true,
      routes: [
        new Route({
          path: &quot;/path2/to/:name&quot;,
          build: (match, state, router) =&gt; {
            data = {
              params: match.params,
              state
            };
            // component.router = router;
            callCount++;
            return { type: &quot;target1&quot; };
          }
        }),
        new Router({
          path: &quot;/path&quot;,
          routes: [
            new Route({
              path: &quot;/path/to/:name([a-zA-Z]*)&quot;,
              build: (match, state, router) =&gt; {
                component1.router = router;
                component1.params = match.params;
                return component1;
              }
            }),
            new Route({
              path: &quot;/path/to/:id&quot;,
              build: (match, state, router, view) =&gt; {
                return null;
              }
            })
          ]
        })
      ]
    });

    router.push(&quot;/path/to/cenk&quot;, { name: &quot;name&quot; });
    component1.router.push(&quot;to/1123&quot;, { name: &quot;name&quot; });
    expect(router.getHistory().entries.map(entry =&gt; entry.pathname)).toEqual([
      &quot;/path/to/cenk&quot;
    ]);
  });

  it(&quot;can be blocked&quot;, () =&gt; {
    let callCount = 0;
    var component1 = {};
    const router = new Router({
      path: &quot;/&quot;,
      isRoot: true,
      routes: [
        new Route({
          path: &quot;/path/to/:name([a-zA-Z]*)&quot;,
          build: (match, state, router) =&gt; {
            component1.router = router;
            component1.params = match.params;
            return component1;
          }
        }),
        new Route({
          path: &quot;/path/to/:id&quot;,
          build: (match, state, router, view) =&gt; {
            return component1;
          }
        })
      ]
    });

    router.addRouteBlocker((location, action, callback) =&gt; {
      callback(false);
    });

    router.push(&quot;/path/to/cenk&quot;, { name: &quot;name&quot; });
    expect(router.getHistory().entries).toEqual([]);

    router.push(&quot;/path/to/cenk&quot;, { name: &quot;name&quot; });
    router.addRouteBlocker((location, action, callback) =&gt; {
      callback(true);
    });

    expect(router.getHistory().entries[0].pathname).toBe(&quot;/path/to/cenk&quot;);
  });
});
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
